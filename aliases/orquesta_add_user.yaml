---
name: "create_user_workflow"
action_ref: "ldap.orquesta_add_user"
description: "Workflow - Create an LDAP user"
formats:
  - display: "create user {{mail}} [expires in {{value=1}} {{dimension=days}}] [username={{username}}] [password={{password}}]"
    representation:
      - "(create|add) user {{mail}} expires in {{expires_in=7}} {{expires_in_dimension=days}}"
      - "(create|add) user {{mail}}"
ack:
  format: "Acknowledged!"
  append_url: false
result:
  format: |
    Create user `{{ execution.parameters.mail }}`: {~}
    {% for task in execution.result.tasks %}
      {% if task.result.stderr and task.result.stderr != '' %}
      Task: *{{ task.name }}*
      Status: {{ task.state }}
      Message: {{ task.result.stderr }}
      {% endif %}
    {% endfor %}
  extra:
    slack:
      color: "{% if execution.result.extra.state == 'SUCCESS' %}good{% else %}danger{% endif %}"
      fields:
        - title: "Username"
          value: "{{ execution.result.out_username|default('') }}"
          short: false
        - title: "E-Mail"
          value: "{{ execution.result.out_mail|default('') }}"
          short: false
        - title: "Password"
          value: "{{ execution.result.out_password|default('') }}"
          short: false
        - title: "Expiration"
          value: "{{ execution.result.out_expires_on|default('') }}"
          short: false
      footer: "{{ execution.id }} - {{ execution.status }} - {{ execution.elapsed_seconds | to_human_time_from_seconds }}"
